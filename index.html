<!DOCTYPE html>
<html>
	<head>
	    <meta charset="utf-8">
	    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	    <meta name="viewport" content="width=device-width, initial-scale=1">
		<title> Project SID, The Ice Age is coming </title>
		<link rel="stylesheet" type="text/css" href ="assets/css/main.css">
		<link rel="stylesheet" type="text/css" href ="assets/css/font.css">
		<!--Font-awesome icons-->
		<link rel="stylesheet" type="text/css" href="assets/css/font-awesome.min.css">
		<!-- Bootstrap, JQuery & Ajax -->
	    <link href="assets/css/bootstrap.css" rel="stylesheet"> 
	    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
 	 	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	    <script src="http://ajax.aspnetcdn.com/ajax/jquery/jquery-1.5.1.js"></script>

	    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/particle-api-js/6.4.3/particle.min.js"></script>
		
		<!--  HIDE/SHOW Graph Script  -->
	    <script type="text/javascript">
			$(document).ready(function(){
				$(".slidingDiv").hide();
				$(".show_hide").show();

				$('.show_hide').click(function(){
				$(".slidingDiv").slideToggle();
				});

			});
	    </script>

	</head>
	<body>

		<!--     Navbar Section     -->
		<SECTION id="top">

			<nav class="navbar navbar-fixed-top navbar-inverse " data-toggle="collapse" data-target=".nav-collapse">
			  <div class="container-fluid">
			    <div class="navbar-header ">
			      <button type="button" class="navbar-toggle toggle-pad" id="nav-main" data-toggle="collapse" data-target="#myNavbar">
			        <span class="icon-bar"></span>
			        <span class="icon-bar"></span>
			        <span class="icon-bar"></span>                        
			      </button>
				  <a href="#top"><img src="assets/img/dankicesym.png" class="symbol navbar-brand"></a>
			      <a class="navbar-brand title-padding" href="#top">Project SID</a>
			    </div>
			    <div class="collapse navbar-collapse" id="myNavbar">
			      <ul class="nav navbar-nav header-link-padding">
			        <li><a href="#control-center">Control Center</a></li>
			        <li><a href="about.html">About</a></li>
			      </ul>
			      <ul class="nav navbar-nav navbar-right icon-padding">
			        <li><a href="https://thingspeak.com/channels/235726" title="Data logging on thingspeak"><span class="fa fa-2x fa-connectdevelop"></span></a></li>
			        <li><a href="https://twitter.com/Project_SID_17" title="SID's twitter page"><span class="fa fa-2x fa-twitter"></span></a></li>
			      </ul>
			    </div>
			  </div>
			</nav>
		</SECTION>


		<!--   Background image section   -->
		<SECTION>
			<div id="homeboi">
				<div class="coverpic coverpic-small" style="background-image: url('assets/img/danksid.jpg'); background-size:cover; width: 100%;"> 
					<div class="container">
						<div class="primary">
							<div class="secondaryborder display-middle text-align-center large-padding stationary-background formfont front-titles">
								<h1 class="font-title grey-font front-titles"><b>PROJECT SID</b></h1>
								<div class="secondary">
									<h2 class="grey-font front-titles">The ice age is here</h2>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</SECTION>




		<!--   Control Center Section    -->
		<SECTION class="control-center-padding">
		<a id="control-center"></a>
			<div class="container">
				<div class="row">
					<div class=" col-md-12 " style="text-align: center;">
						<h2 class="formfont heading"><b>Control Center</b></h2>
					</div>
					<div class="container control-center-padding">
						<div class="row">
							<!-- Information Display Table -->
							<table class="table table-bordered custom-table"  width="244">
								<thead>
									<tr class="success">
										<th>Metric</th>
										<th>Value</th>
									</tr>
								</thead>
								<tbody>
									<tr >
										<td class="col-xs-6">Device Status</td>
										<td  id="status-div" class="col-xs-6"><h4 id="status" class ="text-align-center formfont">Inactive</h4></td>
									</tr>
									<tr>
										<td class="col-xs-6">Temperature
										</td>
										<td class="col-xs-6"><h4 id="temperature" class ="text-align-center formfont">N/A</h4></td>
									</tr>
									<tr>
										<td class="col-xs-6">Humidity</td>
										<td class="col-sm-6"><h4 id="humidity"  class ="text-align-center formfont">N/A</h4></td>
									</tr>
									<tr>
										<td class="col-xs-6"> Reflection Sensor</td>
										<td class="col-xs-6"><h4 id="light" class ="text-align-center formfont">N/A</h4></td>
									</tr>
								</tbody>
							</table>
							<div class="timestamp">
								<span  id="tstamp"></span>
							</div>
						</div>
					</div>
					<br>
					<div class="container">
						<div class="row">
							<div class="row button-align">
								<button type="button" class="btn btn-success connect-button" onclick="start()">Connect</button>
							</div>
						</div>
					</div>
					<br>
					<div class="container">
						<div class="row">
							<div class="row button-align">
								<button type="button" class="btn btn-primary connect-button" id="close">Disconnect</button>
							</div>
						</div>
						<br>
					</div>
					<div class="container">
						<div class="row">
							<div class="row button-align">
								<button  class="btn btn-danger connect-button" type="submit" onclick="functionCall('led', 'Flag')" >Resets SID</button>
							</div>
						</div>
					</div>
					<br>
					<div class="container">
						<div class="row button-align">
							<a href="javascript:void(0)" class="show_hide" type="button"><button class="btn btn-info temp-button">Show/hide Graphs</button></a>
							<div class="slidingDiv iframe-padding">
								<iframe width="450" height="260" style="border: 1px solid #cccccc;" src="https://thingspeak.com/channels/235726/charts/1?bgcolor=%23ffffff&color=%23d62020&dynamic=true&results=60&title=Temperature&type=line&xaxis=Time&yaxis=Degrees+Celcuis"></iframe>
							</div>
							<div class="slidingDiv iframe-padding">
								<iframe width="450" height="260" style="border: 1px solid #cccccc;" src="https://thingspeak.com/channels/235726/charts/2?bgcolor=%23ffffff&color=%23d62020&dynamic=true&results=60&title=Humidity+%28%25%29&type=line&xaxis=Time+&yaxis=Percentage"></iframe>
							</div>
							<div class="slidingDiv iframe-padding">
								<iframe width="450" height="260" style="border: 1px solid #cccccc;" src="https://thingspeak.com/channels/235726/charts/3?bgcolor=%23ffffff&color=%23d62020&dynamic=true&results=20&title=Light+Reading&type=line&xaxis=Time&yaxis=Raw+Light+Value"></iframe>
							</div>
						</div>
					</div>
					<br>
					<div class="send">
						<h4 id="send"></h4>
					</div>
				</div>	
			</div>	
		</SECTION>

		<!-- Footer Section -->
		<SECTION>
		<div class="container">
			<footer class="foot-style">
		    	<p class="position-bottom"><a href="#top">Back to top</a></p>
		    	<p class="float-right">&copy; 2017 Project SID &middot; <a href="https://www.carleton.ca">Created at Carleton University</a> &middot; </p>
		     </footer>
		    </div>
		</SECTION>
   

	<!---    Script for retriving data from Particle Cloud    -->
    <script type="text/javascript"> 
		function start() {

	        document.getElementById("temperature").innerHTML = "Waiting for data...";
			document.getElementById("humidity").innerHTML = "Waiting for data...";
			
	        var deviceID = "3b003a000247353138383138";
	        var accessToken = "f902283102d71b9047eb078869105ec2f83f3a27";
	        var eventSource = new EventSource("https://api.spark.io/v1/devices/" + deviceID + "/events/?access_token=" + accessToken);

	        eventSource.addEventListener('open', function(e) {
	            console.log("Opened!");  
				document.getElementById("status").innerHTML = "Active";
				$('#status-div').css('background-color', 'green');
				},false);

	        eventSource.addEventListener('error', function(e) {
	            console.log("Errored!"); 
				document.getElementById("status").innerHTML = "Error!";
				$('#status-div').css('background-color', 'red');
				},false);

	        eventSource.addEventListener('temperature', function(e) {
	            var parsedData = JSON.parse(e.data);
	            var tempSpan = document.getElementById("temperature");
	            var tsSpan   = document.getElementById("tstamp");
	            tempSpan.innerHTML =  " " + parsedData.data + " ";
	            tempSpan.style.fontSize = "18px";
	            tsSpan.innerHTML = "Last data collection at: " + parsedData.published_at;
	            tsSpan.style.fontSize = "12px";
	        }, false);
			
			eventSource.addEventListener('humidity', function(e) {
	            var parsedData = JSON.parse(e.data);
	            var tempSpan = document.getElementById("humidity");
	            var tsSpan   = document.getElementById("tstamp");
	            tempSpan.innerHTML =  " " + parsedData.data + " ";
	            tempSpan.style.fontSize = "18px";
	            tsSpan.innerHTML = "Last data collection at: " + parsedData.published_at;
	            tsSpan.style.fontSize = "12px";
	        }, false);

			document.getElementById("close").addEventListener("click", function(){
				eventSource.close();
            	console.log("Event Source Closed");

            	document.getElementById("status").innerHTML = "Inactive";
				$('#status-div').css('background-color', 'transparent');

				document.getElementById("temperature").innerHTML = "N/A";
				document.getElementById("humidity").innerHTML = "N/A";
	     	});
	    }
    </script>

    <script type="text/javascript">
    	$('a[href*="#"]:not([href="#"])').click(function() {
		  if (location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') && location.hostname == this.hostname) {
		    var target = $(this.hash);
		    target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
		    if (target.length) {
		      $('html, body').animate({
		        scrollTop: target.offset().top
		      }, 1000);
		      return false;
		    }
		  }
		});
    </script>



	<script src="http://cdn.jsdelivr.net/sparkjs/1.0.0/spark.min.js"></script>

	<!-- Script for sending reset command -->
	<script>

		var accessToken = "f902283102d71b9047eb078869105ec2f83f3a27";
		var deviceID = "3b003a000247353138383138";
		spark.on('login', function(response) {   
		    console.log(response);   
		    });

		var callback = function(err, data) {
		    if (err) {
		      console.log('An error occurred while getting access:', err);
		    }
		    else {
		    console.log('Particle accessed successfully:', data);
		    }
		};
		function functionCall(functionName, functionArgument){
			spark.callFunction(deviceID, functionName, functionArgument, callback);  
			document.getElementById("status").innerHTML = "Resetting...";
			$('#status-div').css('background-color', 'red');
			setTimeout(
            function() {
               document.getElementById("status").innerHTML = "Active";
				$('#status-div').css('background-color', 'green');
            },
            9000);
		}
		spark.login({ accessToken: accessToken });
	</script>

	</body>
</html>